---
title: "Learning R"
output:
   md_document:
      variant: markdown
---

```{r setup, include=FALSE}
library(tidyverse)
theme_set(theme_bw())
knitr::opts_chunk$set(cache = FALSE)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.path = "img/")
```

## Introduction

This README was generated by running `readme.Rmd` in RStudio Server.

Install packages if missing and load.

```{r load_package, message=FALSE, warning=FALSE}
.libPaths('/packages')
my_packages <- 'beepr'

for (my_package in my_packages){
   if(!require(my_package, character.only = TRUE)){
      install.packages(my_package, '/packages')
   }
  library(my_package, character.only = TRUE)
}
```

## Learning R

>"To understand computations in R, two slogans are helpful:
>
>* Everything that exists is an object.
>* Everything that happens is a function call."
>
> --John Chambers

### Vectors

R is a vectorised language and what this means is that you can perform operations on vectors without having to iterate through each element. A vector is simply "a single entity consisting of a collection of things" but these items must all belong to the same class. If you try to create a vector with different classes, the vector will be coerced in the following order: `logical` < `integer` < `numeric` < `character`.

```{r vector_coercion}
my_char <- c(1, 3.14, TRUE, 'str')
class(my_char)

my_num <- c(1, 2, 3.14, 4)
class(my_num)
```

You can easily square each number in a vector by applying a exponential function.

```{r my_int_squared}
my_int <- 1:6
my_int^2
```

You can operate on a vector using another vector too. If the right vector isn't the same length as the left vector but is a multiple, R performs a procedure called "recycling" that will re-use the right vector on the next set of values.

```{r vec_recycling}
my_int + c(1, 2)
```

Named vectors can be used as simple lookup tables.

```{r lookup_table}
my_lookup <- c(
  "HKG" = "Hong Kong",
  "PNG" = "Papua New Guinea",
  "AUS" = "Australia",
  "JPN" = "Japan"
)

my_lookup["PNG"]
```

### Lists

Unlike vectors, lists can be used to store heterogeneous things.

```{r my_list}
my_list <- list(
  my_func = function(x){x^2},
  my_df = data.frame(a = 1:3),
  my_vec = 1:6
)

my_list$my_func(my_list$my_vec)
```

`lapply` can be used to apply a function to each item in a list and will return a list.

```{r lapply}
my_list <- list(
  a = 1:3,
  b = 4:10,
  c = 11:20
)

lapply(my_list, sum)
```

Another handy function is the `do.call` function, which constructs and executes a function call on a list. The example below is useful for converting a list into a matrix.

```{r do_call}
my_list <- list(
  a = 1:3,
  b = 4:6,
  c = 7:9
)

# returns a matrix
do.call(what = rbind, args = my_list)
```

There is also the [purrr::map](https://purrr.tidyverse.org/reference/map.html) function, that is [similar](https://jennybc.github.io/purrr-tutorial/ls01_map-name-position-shortcuts.html) to the apply functions in base R, but you explicitly specify the output type. The `map_lgl` function will return logicals, i.e. Booleans.

```{r map_lgl}
map_lgl(.x = 1:10, .f = function(x) x > 5)
```

### Objects.

[Base types](https://adv-r.hadley.nz/base-types.html).

### Useful tips

When asking for help online, it is useful to include a minimal example that includes some data specific to your question. To easily convert data into code, use the `dput()` function. The example below is just for illustrative purposes since the `women` dataset is included with R, so you would not need to generate code for it.

```{r dput}
dput(women)
```

### Hacks

There are probably better ways to do the following, which is why I have labelled them as hacks, so follow at your own peril.

### Library paths

Some R packages require libraries not included in the default library path. Use `Sys.setenv` to include additional library paths. First we'll get the default path.

```{r get_ld_library_path}
Sys.getenv("LD_LIBRARY_PATH")
```

Now we will add `/usr/include` to `LD_LIBRARY_PATH` and get the updated library path.

```{r set_ld_library_path}
new_path <- paste0(Sys.getenv("LD_LIBRARY_PATH"), ":", "/usr/include")
Sys.setenv("LD_LIBRARY_PATH" = new_path)
Sys.getenv("LD_LIBRARY_PATH")
```

## Session info

Time built.

```{r time, echo=FALSE}
Sys.time()
```

Session info.

```{r session_info, echo=FALSE}
sessionInfo()
```