---
title: "Object-Oriented Programming in R"
output:
   github_document:
      toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache = FALSE)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.path = "img/")

.libPaths('/packages')
my_packages <- c('sloop')

using<-function(...) {
   # https://stackoverflow.com/a/44660688
   libs<-unlist(list(...))
   req<-unlist(lapply(libs,require,character.only=TRUE))
   need<-libs[req==FALSE]
   if(length(need)>0){
      install.packages(need)
      lapply(need,require,character.only=TRUE)
   }
}

using(my_packages)
```

# Introduction

Notes from the [Advanced R](https://adv-r.hadley.nz/oo.html).

Everything that exists in R is an object but this does not mean that everything
is object-oriented. In R there are **base objects** and **OO objects** and we
can use `is.object()` or `sloop::otype()` to tell which is which.

```{r object_type}
is.object(1:10)
sloop::otype(1:10)

is.object(mtcars)
sloop::otype(mtcars)
```

Technically, the difference between base and OO objects is that OO objects have
a "class" attribute.

```{r attribute}
attr(1:10, "class")
attr(mtcars, "class")
```

The `class()` function is safe to apply to S3 and S4 objects but returns
misleading results when applied to base objects. It is safer to use
`sloop::s3_class()`, which returns the implicit class that the S3 and S4 systems
will use to pick methods.

```{r s3_class}
x <- matrix(1:4, nrow = 2)
class(x)
sloop::s3_class(x)
```

## Base types

While only OO objects have a class attribute, every object has a **base type**.

```{r typeof}
typeof(1:10)
typeof(mtcars)
```

Base types do not form an OOP system because functions that behave differently
for different base types are primarily written in C code that uses switch
statements. This means that only R-core can create new types, and creating a new
type is a lot of work because every switch statement needs to be modified to
handle a new case.

### Numeric type

R uses numeric to mean three slightly different things:

1. In some places numeric is used as an alias for the double type.
2. In the S3 and S4 systems, numeric is used as a shorthand for either integer
   or double type, and is used when picking methods:

```{r numeric_type}
sloop::s3_class(1)
sloop::s3_class(1L)
```

3. `is.numeric()` tests for objects that _behave_ like numbers. For example,
   factors have type "integer" but do not behave like numbers.

```{r factor_type}
typeof(factor("x"))
is.numeric(factor("x"))
```

## Session info

This document was generated by rendering `oop.Rmd` using `rmd_to_md.sh`.

```{r time, echo=FALSE}
Sys.time()
```

Session info.

```{r session_info, echo=FALSE}
sessionInfo()
```
