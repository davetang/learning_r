---
title: "The purrr package"
output:
   github_document:
      toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache = FALSE)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.path = "img/")

.libPaths('/packages')
my_packages <- c('rlang')

using<-function(...) {
   # https://stackoverflow.com/a/44660688
   libs<-unlist(list(...))
   req<-unlist(lapply(libs,require,character.only=TRUE))
   need<-libs[req==FALSE]
   if(length(need)>0){
      install.packages(need)
      lapply(need,require,character.only=TRUE)
   }
}

using(my_packages)
```

# Introduction

<https://purrr.tidyverse.org/>:

> purrr enhances R's functional programming (FP) toolkit by providing a complete and consistent set of tools for working with functions and vectors. If you've never heard of FP before, the best place to start is the family of map() functions which allow you to replace many for loops with code that is both more succinct and easier to read. The best place to learn about the map() functions is the iteration chapter in R for Data Science.

See the [cheatsheet](https://github.com/rstudio/cheatsheets/blob/main/purrr.pdf) for a quick overview of the capabilities of {purrr}.

## Iteration

> [In this chapter](https://r4ds.hadley.nz/iteration), you'll learn tools for iteration, repeatedly performing the same action on different objects. Iteration in R generally tends to look rather different from other programming languages because so much of it is implicit and we get it for free. For example, if you want to double a numeric vector x in R, you can just write 2 * x. In most other languages, you'd need to explicitly double each element of x using some sort of for loop.

## The purrr package

### Map functions

Use `map(.x, .f, ...)` to apply a function to each element of a list or vector, and return a list.

```{r map}
l1 <- list(
  x = c("a", "b"),
  y = c("c", "d")
)
purrr::map(l1, sort, decreasing = TRUE)
```

Use `map2(.x, .y, .f, ...)` to apply a function to pairs of elements from two lists or vectors, return a list.

```{r map2}
x <- list(1, 2, 3)
y <- list(4, 5, 6)
purrr::map2(x, y, \(x, y) x*y)
```

Use `pmap(.l, .f, ...)` to apply a function to groups of elements from a list of lists or vectors, return a list.

```{r pmap}
x <- list(1, 2, 3)
y <- list(4, 5, 6)
z <- list(7, 8, 9)
purrr::pmap(
  list(x, y, z),
  function(first, second, third) first * (second + third)
)
```

### `safely()`

> Creates a modified version of .f that always succeeds. It returns a list with components result and error. If the function succeeds, result contains the returned value and error is NULL. If an error occurred, error is an error object and result is either NULL or otherwise.

```{r sum_safely}
x <- c(1:20, 'b')
y <- 1:20

sum_safely <- purrr::safely(sum)

res_x <- sum_safely(x)
res_y <- sum_safely(y)

str(res_x)
str(res_y)

is.null(res_x$error)
is.null(res_y$error)
```

## Session info

This document was generated by rendering `r knitr::current_input()` using `rmd_to_md.sh`.

```{r time, echo=FALSE}
Sys.time()
```

Session info.

```{r session_info, echo=FALSE}
sessionInfo()
```
